<h2 align="center">宏的使用</h2>


## 找Bug

```cpp
//Project - Macro
#include <iostream>
using namespace std;

#define SQUARE(x)  x*x

int main() {
    cout << SQUARE(3) << endl;      //3的平方，预期输出为9
    cout << SQUARE(3+2) << endl;    //3+2的平方，预期输出为5的平方，即25
    return 0;
}
```

### 说明

**问题分析：**

`SQUARE(3+2)` 的结果是 11，而不是预期的 25。这是因为预处理器的工作原理导致的。

**宏展开过程：**

宏定义 `SQUARE(x)` 在预处理阶段进行简单的文本替换：
- `SQUARE(3+2)` 中的 `x` 被替换为 `3+2`
- 展开后：`3+2*3+2`
- 由于运算符优先级，实际计算为：`3 + (2*3) + 2 = 3 + 6 + 2 = 11`

**正确的写法：**

```cpp
// 方法1：使用括号（推荐）
#define SQUARE(x)  ((x)*(x))

// 方法2：使用内联函数（C++推荐）
inline int square(int x) {
    return x * x;
}

// 方法3：使用模板函数（C++推荐）
template<typename T>
inline T square(T x) {
    return x * x;
}
```

**要点：**
- 宏展开：预处理器进行简单的文本替换，不进行语法分析
- 运算符优先级：宏展开后可能改变运算顺序
- 括号的重要性：宏定义中的参数和整个表达式都应该用括号包围
- 现代C++：优先使用内联函数或模板函数，而不是宏

---
* [示例代码](../../source/bug604/source/main.cpp)
---
